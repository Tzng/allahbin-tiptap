"use strict";(self.webpackChunk_allahbin_tiptap=self.webpackChunk_allahbin_tiptap||[]).push([[433],{54329:function(Yt,te,u){u.r(te),u.d(te,{default:function(){return Gt}});var Ae=u(48305),I=u.n(Ae),be=u(26068),E=u.n(be),je=u(67825),ne=u.n(je),Te=u(90228),ae=u.n(Te),Le=u(87999),Me=u.n(Le),A=u(50959),Zt=u(11180),Qt=u(70680),H=u(52063),Se=H.NB.create({name:"ATail",addOptions:function(){return{HTMLAttributes:{class:"a-tiptap-tail"}}},content:"inline*",group:"block",defining:!0,parseHTML:function(){return[{tag:"div.a-tiptap-tail",getAttrs:function(n){return{class:"a-tiptap-tail"}}}]},renderHTML:function(e){var n=e.node,a=e.HTMLAttributes,t=E()(E()({},a),{},{class:"a-tiptap-tail"});return["div",t,0]},addCommands:function(){var e=this;return{setATail:function(){return function(a){var t=a.commands;return t.setNode(e.name,{})}},toggleATail:function(){return function(a){var t=a.commands;return t.toggleNode(e.name,"paragraph",{})}}}},addInputRules:function(){return[(0,H.zK)({find:/^!-\s$/,type:this.type,getAttributes:function(){return{class:"a-tiptap-tail"}}})]}}),Ee=H.NB.create({name:"ATitle",addOptions:function(){return{levels:[1,2,3],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes:function(){return{level:{default:1,rendered:!1}}},parseHTML:function(){return console.log("parseHTML"),this.options.levels.map(function(e){return{tag:"div.a-tiptap-title".concat(e),attrs:{level:e,class:"a-tiptap-title".concat(e)}}})},renderHTML:function(e){var n=e.node,a=e.HTMLAttributes;console.log("renderHTML");var t=this.options.levels.includes(n.attrs.level),r=t?n.attrs.level:this.options.levels[0];return["div",(0,H.P1)(this.options.HTMLAttributes,a,{class:"a-tiptap-title".concat(r)}),0]},addCommands:function(){var e=this;return{setATitle:function(a){return function(t){var r=t.commands;return console.log("setHeading"),e.options.levels.includes(a.level)?r.setNode(e.name,a):!1}},toggleATitle:function(a){return function(t){var r=t.commands;return console.log("toggleATitle"),e.options.levels.includes(a.level)?r.toggleNode(e.name,"paragraph",a):!1}}}},addInputRules:function(){var e=this;return this.options.levels.map(function(n){return(0,H.zK)({find:new RegExp("^(!{1,".concat(n,"})\\s$")),type:e.type,getAttributes:{level:n,class:"a-tiptap-title".concat(n)}})})}}),He=H.NB.create({name:"AWenHao",addOptions:function(){return{HTMLAttributes:{class:"a-tiptap-wenhao"}}},content:"inline*",group:"block",defining:!0,parseHTML:function(){return[{tag:"div.a-tiptap-wenhao",getAttrs:function(n){return{class:"a-tiptap-wenhao"}}}]},renderHTML:function(e){var n=e.node,a=e.HTMLAttributes;console.log("renderHTML");var t=E()(E()({},a),{},{class:"a-tiptap-wenhao"});return["div",t,0]},addCommands:function(){var e=this;return{setWenHao:function(){return function(a){var t=a.commands;return t.setNode(e.name,{})}},toggleWenHao:function(){return function(a){var t=a.commands;return t.toggleNode(e.name,"paragraph",{})}}}},addInputRules:function(){return[(0,H.zK)({find:/^!~\s$/,type:this.type,getAttributes:function(){return{class:"a-tiptap-wenhao"}}})]}}),P=u(16152),ie=u(72267),re=u(33781),se=u(57559),Ne=u(80322),Re=u(60115),Be=u(23012),Ie=u(14821),Pe=u(92060),Oe=u(45057),G=u(50327),oe=u(57061),le=u(72318),Fe=u(82321),$e=u(70197),we=u(16689),De=u(96431),We=u(61161),ze=u(58565),Ve=u(81915),Ue=u(71815),Ke=u(61683),Je=u(54006),Ge=u(73642),Xe=u(3804),Ye=u(72553),de=u(47241),Ze=u(36176),Qe=u(15558),Z=u.n(Qe),_e=u(99347),V=u(3317),qe=H.hj.create({name:"markdownClipboardCopy",addProseMirrorPlugins:function(){var e=this;return[new V.Sy({key:new V.H$("markdownClipboardCopy"),props:{clipboardTextSerializer:function(a){var t,r,s=e.editor.schema.topNodeType.createAndFill(void 0,a.content);return s&&((t=e.editor.storage.markdown)===null||t===void 0||(r=t.getMarkdown)===null||r===void 0?void 0:r.call(t,s))||""}}})]}}),ue=u(83578),et=u(335),D=u.n(et),tt=function(e){return e.schema.nodes.codeBlock&&(0,H.Ig)(e,"codeBlock")||e.schema.marks.code&&(0,H.yw)(e,"code")},nt=function(e){var n=e.match(/^```/gm);if(n&&n.length>1||e.match(/\[[^]+]\(https?:\/\/\S+\)/gm)||e.match(/\[[^]+]\(\/\S+\)/gm)||e.match(/^#{1,6}\s+\S+/gm)||e.match(/^!{1,3}\s+\S+/gm)||e.match(/^!-\s+\S+$/gm)||e.match(/^!~\s+\S+$/gm))return!0;var a=e.match(/^\s*[\d-*]\s+\S+/gm);if(a&&a.length>1)return!0;var t=e.match(/^\s*[-*]\s\[[ xX]\]\s+\S+/gm);return!!(t&&t.length>1||e.match(/^>\s+\S+/gm)||e.match(/^---/gm)||e.match(/^!\[[^]+]\(https?:\/\/\S+\)/gm)||e.match(/^\|.*\|$/gm)||e.match(/\*\*[^]+?\*\*/gm)||e.match(/_[^]+?_/gm)||e.match(/~~[^]+?~~/gm)||e.match(/`[^]+?`/gm))},at=function(e){var n=/<div class="a-tiptap-title(\d)">([\s\S]*?)<\/div>/g,a=e.matchAll(n),t=e,r=D()(a),s;try{for(r.s();!(s=r.n()).done;){var i=s.value,h=parseInt(i[1]),l=i[2].trim(),c="".concat("!".repeat(h)," ").concat(l);t=t.replace(i[0],c)}}catch(f){r.e(f)}finally{r.f()}return t},it=function(e){var n=/<div class="a-tiptap-wenhao">([\s\S]*?)<\/div>/g,a=e.matchAll(n),t=e,r=D()(a),s;try{for(r.s();!(s=r.n()).done;){var i=s.value,h=i[1].trim().length,l=i[1].trim(),c="".concat("!~".repeat(h>1?1:h)," ").concat(l);t=t.replace(i[0],c)}}catch(f){r.e(f)}finally{r.f()}return t},rt=function(e){var n=/<div class="a-tiptap-tail">([\s\S]*?)<\/div>/g,a=e.matchAll(n),t=e,r=D()(a),s;try{for(r.s();!(s=r.n()).done;){var i=s.value,h=i[1].trim(),l="!- ".concat(h);t=t.replace(i[0],l)}}catch(c){r.e(c)}finally{r.f()}return t},ce=function(e){var n=/^!-\s+(.*)$/gm,a=e.matchAll(n),t=e,r=D()(a),s;try{for(r.s();!(s=r.n()).done;){var i=s.value,h=i[1].trim(),l='<div class="a-tiptap-tail">'.concat(h,"</div>");t=t.replace(i[0],l)}}catch(c){r.e(c)}finally{r.f()}return t},he=function(e){var n=/^!~\s+(.*)$/gm,a=e.matchAll(n),t=e,r=D()(a),s;try{for(r.s();!(s=r.n()).done;){var i=s.value,h=i[1].trim(),l='<div class="a-tiptap-wenhao">'.concat(h,"</div>");t=t.replace(i[0],l)}}catch(c){r.e(c)}finally{r.f()}return t},fe=function(e){var n=/^(!{1,3})\s+(.*)$/gm,a=e,t=e.matchAll(n),r=D()(t),s;try{for(r.s();!(s=r.n()).done;){var i=s.value,h=i[1],l=h.length,c=i[2].trim(),f='<div class="a-tiptap-title'.concat(l,'">').concat(c,"</div>");a=a.replace(i[0],f)}}catch(p){r.e(p)}finally{r.f()}return a},st=H.hj.create({name:"markdownClipboardPaste",priority:50,addProseMirrorPlugins:function(){var e=this;return[new V.Sy({key:new V.H$("markdownClipboardPaste"),props:{handlePaste:function(a,t){var r=e.editor.isEditable,s=t.clipboardData;if(!r||!s||s.files.length!==0)return!1;var i=s.getData("text/plain"),h=s.getData("text/html");if(h.length>0)return!1;if(tt(a.state))return t.preventDefault(),a.dispatch(a.state.tr.insertText(i)),!0;if(nt(i)){var l,c,f=ce(i);f=he(f),f=fe(f);var p=(l=e.editor.storage.markdown)===null||l===void 0||(l=l.parser)===null||l===void 0||(c=l.parse)===null||c===void 0?void 0:c.call(l,f,{inline:!1});if(console.log("html",p),!p||typeof p!="string")return!1;var C=ue.aw.fromSchema(e.editor.schema),j=(0,H.q_)(p),y=C.parse(j,{});console.log("node",y);var T=y.content,g=a.state.selection.content();return a.dispatch(a.state.tr.replaceSelection(new ue.p2(T,g.openStart,g.openEnd))),!0}return!1}}})]}}),ot=_e.U.extend({name:"markdown",priority:50,addOptions:function(){var e;return E()(E()({},(e=this.parent)===null||e===void 0?void 0:e.call(this)),{},{paste:!0,copy:!0})},onBeforeCreate:function(){var e,n=this;(e=this.parent)===null||e===void 0||e.call(this),this.editor.storage.markdown.getMarkdown=function(a){var t=n.editor.storage.markdown.serializer.serialize(a!=null?a:n.editor.state.doc);return t=at(t),t=it(t),t=rt(t),t}},addExtensions:function(){return[].concat(Z()(this.options.copy?[qe]:[]),Z()(this.options.paste?[st]:[]))},onCreate:function(){this.editor.options.content=this.editor.options.initialContent,delete this.editor.options.initialContent}}),lt=u(60633),dt=H.hj.create({name:"starterKit",addExtensions:function(){var e=[],n=[];if(this.options.commands!==!1&&e.push(P.Gh),this.options.highPriorityKeymap!==!1&&e.push(P.Yg),this.options.lowPriorityKeymap!==!1&&e.push(P.vR),this.options.document!==!1&&e.push(ie.B),this.options.paragraph!==!1&&(e.push(re.n.configure(this.options.paragraph)),n.push("paragraph")),this.options.text!==!1&&e.push(se.x),this.options.textAlign!==!1&&e.push(Ne.P.configure(E()({types:["heading","paragraph"]},this.options.textAlign))),this.options.bold!==!1&&e.push(Ke.d8.configure(this.options.bold)),this.options.italic!==!1&&e.push(Je.Tx.configure(this.options.italic)),this.options.strike!==!1&&e.push(Ge.Re.configure(this.options.strike)),this.options.code!==!1&&e.push(Xe.EK.configure(this.options.code)),this.options.link!==!1&&e.push(oe.rU.configure(this.options.link)),this.options.heading!==!1&&(e.push(Re.X.configure(this.options.heading)),n.push("heading")),this.options.blockquote!==!1&&(e.push(Ue.V6.configure(this.options.blockquote)),n.push("blockquote")),this.options.hardBreak!==!1&&e.push(Be.U.configure(this.options.hardBreak)),this.options.horizontalRule!==!1&&(e.push(Ze.b.configure(this.options.horizontalRule)),n.push("horizontalRule")),this.options.listsIndentation!==!1&&e.push($e.R_.configure(this.options.listsIndentation)),this.options.indentation!==!1&&e.push(Fe.I.configure(this.options.indentation)),this.options.bulletList!==!1&&e.push(we.D.configure(this.options.bulletList)),this.options.orderedList!==!1&&e.push(De.G.configure(this.options.orderedList)),(this.options.bulletList!==!1||this.options.orderedList!==!1)&&e.push(We.H.configure(this.options.listItem)),this.options.taskList!==!1&&(e.push(ze.a.configure(this.options.taskList)),e.push(Ve.Uf.configure(this.options.taskItem))),(this.options.bulletList!==!1||this.options.orderedList!==!1||this.options.taskList!==!1)&&n.push("list"),this.options.codeBlock!==!1&&(e.push(Ye.dn.configure(this.options.codeBlock)),n.push("codeBlock")),this.options.image!==!1&&(this.options.uploader!==!1?(e.push(le.Ee.configure(this.options.image)),n.push("image")):console.warn("Uploader extension is required for image extension. Please enable uploader extension.")),this.options.table!==!1){var a=G.pj.extend({content:"(".concat(n.join(" | "),")+")});e.push(G.iA.configure(this.options.table)),e.push(G.SC.configure(this.options.tableRow)),e.push(a.configure(this.options.tableCell))}return this.options.emoji!==!1&&e.push(de.dy.configure(E()({enableEmoticons:!0,forceFallbackImages:!1,suggestion:de.Jz},this.options.emoji))),this.options.history!==!1&&e.push(Ie.A.configure(this.options.history)),this.options.dropcursor!==!1&&e.push(Pe.m.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&e.push(Oe.f),this.options.uploader!==!1&&e.push(lt.Qm.configure(this.options.uploader)),this.options.markdown!==!1&&e.push(ot.configure(E()({linkify:!0,breaks:!0,tightLists:!0,paste:!0,copy:!1},this.options.markdown))),e}}),_t=null,ve=u(35605),v=u(33617),o=u(11527),ut=function(e){var n=e.className,a=e.style,t=e.title,r=(0,v.W6)(function(){return{isActive:function(){return(0,P.zh)(s.state,"link")},disabled:function(){return!s.state.schema.marks.link||!s.can().chain().focus().toggleMark("link").run()}}}),s=r.editor,i=r.statusMap;return(0,o.jsx)(v.o1,{className:n,style:a,children:(0,o.jsx)(v.u,{text:t||"\u94FE\u63A5 (".concat(v.WD," + K)"),children:(0,o.jsx)(v.zx,{onClick:function(){var l,c;return s==null||(l=(c=s.chain().focus()).toggleLink)===null||l===void 0?void 0:l.call(c,{href:""}).run()},isActive:i==null?void 0:i.isActive,disabled:i==null?void 0:i.disabled,children:(0,o.jsx)(ve.c9z,{})})})})},ct=u(1728),U=u(19518),ht=function(e){var n=e.text,a=e.href,t=e.onConfirm,r=e.onCancel,s=(0,A.useRef)(null),i=(0,A.useRef)(null),h=(0,A.useState)(n),l=I()(h,2),c=l[0],f=l[1],p=(0,A.useState)(a),C=I()(p,2),j=C[0],y=C[1],T=(0,A.useCallback)(function(){t==null||t({text:c||j,href:j})},[t,c,j]);return(0,A.useEffect)(function(){var g=setTimeout(function(){if(c){if(!j){var b;(b=i.current)===null||b===void 0||b.focus()}}else{var k;(k=s.current)===null||k===void 0||k.focus()}},200);return function(){clearTimeout(g)}},[]),(0,o.jsxs)("div",{className:"tide-editor-popup tide-link-popup",children:[(0,o.jsxs)("div",{className:"tide-link-popup__row",children:[(0,o.jsx)("label",{className:"tide-link-popup__label",children:"\u6587\u672C"}),(0,o.jsx)("input",{className:"tide-link-popup__input",ref:s,value:c,onChange:function(k){return f(k.target.value)}})]}),(0,o.jsxs)("div",{className:"tide-link-popup__row",children:[(0,o.jsx)("label",{className:"tide-link-popup__label",children:"\u94FE\u63A5"}),(0,o.jsx)("input",{className:"tide-link-popup__input",ref:i,value:j,onChange:function(k){return y(k.target.value)},onKeyDown:function(k){k.key==="Enter"&&j&&T()}})]}),(0,o.jsxs)("div",{className:"tide-link-popup__btn-group",children:[(0,o.jsx)("button",{className:"tide-link-popup__button tide-link-popup__button--basic",style:{marginLeft:8},onClick:r,children:"\u53D6\u6D88"}),(0,o.jsx)("button",{className:"tide-link-popup__button tide-link-popup__button--primary",onClick:T,disabled:!j,children:"\u786E\u5B9A"})]})]})},ft=function(e,n){var a=n||{},t=a.dom,r=a.defaultText,s=a.defaultHref,i=e.state,h=e.schema,l=i.selection,c=l.$from,f=l.from,p=l.to,C=l.empty,j=(0,H.TP)(h.marks.link,i.schema),y=(0,P.zh)(i,j.name),T=e.getAttributes(j),g,k;if(!y)g=f,k=p;else{var b;if(C){var L=(0,H.IH)(c,j,T);L&&(b={from:L.from,to:L.to})}else b={from:f,to:p};if(!b)return;g=b.from,k=b.to}var N="",R="";i.doc.nodesBetween(g,k,function(B,M,S,m){var x,O;if(B.isInline){var F=((x=(O=B.type.spec).toText)===null||x===void 0?void 0:x.call(O,{node:B,pos:M,parent:S,index:m}))||B.textContent||"";N+=Z()(F).slice(Math.max(0,g-M),Math.max(0,k-M)).join("")}}),y?(N=N||i.doc.textBetween(g,k)||"",R=T.href):(N=N||i.doc.textBetween(g,k)||r||"",R=s||""),(0,U.Zr)({editor:e,placement:"bottom-start",componentRender:function(M){return new U.M_(ht,{props:{text:N,href:R,onConfirm:function(m){var x;N===m.text?e.chain().setTextSelection({from:g,to:k}).setLink({href:m.href}).run():(e.chain().deleteRange({from:g,to:k}).insertContentAt(g,m.text,{updateSelection:!0}).run(),e.chain().command(function(O){var F=O.tr,ee=Math.min(g,F.selection.from),w=F.selection.to;return F.setSelection(V.Bs.create(F.doc,ee,w)),!0}).setLink({href:m.href}).run()),(x=M.instance)===null||x===void 0||x.hide(),e.commands.focus()},onCancel:function(){var m;(m=M.instance)===null||m===void 0||m.hide(),e.commands.focus()}},editor:e})},tippyOptions:{getReferenceClientRect:function(){return t?t.getBoundingClientRect():(0,H.pr)(e.view,g,k)}}})},vt=/(?:^|\s)\[(.+?)]\((.+?)\)\s$/,pt=ct.rU.extend({inclusive:!1,name:"link",addOptions:function(){var e;return E()(E()({},(e=this.parent)===null||e===void 0?void 0:e.call(this)),{},{openOnClick:!1,linkOnPaste:!1,autolink:!0})},addAttributes:function(){return{href:{default:null,parseHTML:function(n){var a;return"".concat((a=n.getAttribute("href"))!==null&&a!==void 0?a:"")}},target:{default:this.options.HTMLAttributes.target},"data-id":{default:null,parseHTML:function(n){var a;return"".concat((a=n.getAttribute("data-id"))!==null&&a!==void 0?a:"")}}}},parseHTML:function(){return[{tag:'a[href]:not([href *= "javascript:" i]):not([data-type])'}]},addCommands:function(){var e,n=this;return E()(E()({},(e=this.parent)===null||e===void 0?void 0:e.call(this)),{},{toggleLink:function(t){return function(r){var s=r.chain,i=r.editor;return(0,P.zh)(i.state,n.name)?s().unsetLink().run():(ft(n.editor,{defaultHref:t.href}),!0)}}})},addKeyboardShortcuts:function(){var e=this;return{"Mod-k":function(){return e.editor.chain().toggleLink({href:""}).run()}}},addInputRules:function(){return[(0,H.Cf)({find:vt,type:this.type,getAttributes:function(n){var a=I()(n,3),t=a[2];return n.pop(),{href:t}}})]}}),qt=function(e){var n=e.editor,a=useRef(null),t=useState(""),r=_slicedToArray(t,2),s=r[0],i=r[1],h=useState(""),l=_slicedToArray(h,2),c=l[0],f=l[1],p=useCallback(function(){var y=isActive(n.state,LinkExtension.name);if(y){var T=n.getAttributes(LinkExtension.name);i(T.href||""),f(T.target||"")}else i(""),f("");return y},[n]),C=useCallback(function(){n.chain().blur().focus().run(),showLinkEditPopup(n)},[n]),j=useCallback(function(){var y=n.view.state.selection.empty;if(y){var T=n.getAttributes(LinkExtension.name);n.chain().extendMarkRange(LinkExtension.name,T).unsetLink().run()}else n.chain().unsetLink().run()},[n]);return n.state.schema.marks.link?_jsx(SelectionBubbleMenu,{pluginKey:"linkBubbleMenu",editor:n,shouldShow:p,reference:"mark",referenceMarkType:LinkExtension.name,placement:"bottom-start",children:_jsxs("div",{ref:a,className:"tide-menu-bar tide-menu-bar-bubble",children:[_jsx("span",{className:"tide-menu-bar-bubble__link",children:_jsx("a",{href:s,target:c,rel:"noopener noreferrer nofollow",children:s})}),_jsx("button",{className:"tide-menu-bar__btn tide-menu-bar__item",onClick:C,children:_jsx(IconPenBold,{})}),_jsx("button",{className:"tide-menu-bar__btn tide-menu-bar__item",onClick:j,children:_jsx(IconChainSlashBold,{})})]})}):null},mt=u(25298),gt=u.n(mt),xt=u(17069),yt=u.n(xt),kt=u(62657),W=u.n(kt),Ct=u(9504),Q=u.n(Ct),At=u(38836),_=u.n(At),bt=u(21742),jt=u.n(bt),Tt=u(83136),Lt=u.n(Tt),Mt=u(82092),z=u.n(Mt),St=["readOnlyEmptyView","readOnlyShowMenu","menuEnableUndoRedo","menuEnableFullscreen","fullscreen","onFullscreenChange","onReady","onChange"],Et=function(d){jt()(n,d);var e=Lt()(n);function n(a){var t;gt()(this,n);var r=a.readOnlyEmptyView,s=a.readOnlyShowMenu,i=s===void 0?!1:s,h=a.menuEnableUndoRedo,l=h===void 0?!0:h,c=a.menuEnableFullscreen,f=c===void 0?!0:c,p=a.fullscreen,C=p===void 0?!1:p,j=a.onFullscreenChange,y=a.onReady,T=a.onChange,g=ne()(a,St);return t=e.call(this,E()(E()({extensions:[ie.B,re.n,se.x],editorProps:{attributes:{spellCheck:"false"}}},g),{},{onCreate:function(b){var L,N=b.editor,R=N.state,B=N.view;if(R.plugins.length>0){var M=[],S=[];R.plugins.forEach(function(m){m.key.includes("Suggestion")?S.push(m):M.push(m)}),B.updateState(R.reconfigure({plugins:[].concat(S,M)}))}(L=g.onCreate)===null||L===void 0||L.call(g,b),y==null||y(b.editor)},onUpdate:function(b){var L;(L=g.onUpdate)===null||L===void 0||L.call(g,b),T==null||T(b.editor.getJSON(),b.editor)}})),z()(W()(t),"readOnlyEmptyView",void 0),z()(W()(t),"readOnlyShowMenu",void 0),z()(W()(t),"menuEnableUndoRedo",void 0),z()(W()(t),"menuEnableFullscreen",void 0),z()(W()(t),"fullscreen",void 0),z()(W()(t),"onFullscreenChange",void 0),t.readOnlyEmptyView=r,t.readOnlyShowMenu=i,t.menuEnableUndoRedo=l,t.menuEnableFullscreen=f,t.fullscreen=C,t.onFullscreenChange=j,t}return yt()(n,[{key:"setFullscreen",value:function(t){var r;this.fullscreen=t,(r=this.onFullscreenChange)===null||r===void 0||r.call(this,t,this),this.emit("update",{editor:this,transaction:this.state.tr}),t&&this.commands.focus(this.options.autofocus)}},{key:"setContent",value:function(t,r,s){return typeof t=="string"&&(t=he(t),t=ce(t),t=fe(t)),this.commands.setContent(t,r,s)}},{key:"getMarkdown",value:function(){var t,r;return((t=this.storage.markdown)===null||t===void 0||(r=t.getMarkdown)===null||r===void 0?void 0:r.call(t))||""}},{key:"isReadOnly",get:function(){return!this.isEditable}},{key:"on",value:function(t,r){return Q()(_()(n.prototype),"on",this).call(this,t,r)}},{key:"emit",value:function(t){for(var r,s=arguments.length,i=new Array(s>1?s-1:0),h=1;h<s;h++)i[h-1]=arguments[h];return(r=Q()(_()(n.prototype),"emit",this)).call.apply(r,[this,t].concat(i))}},{key:"off",value:function(t,r){return Q()(_()(n.prototype),"off",this).call(this,t,r)}}]),n}(U.ML),Ht=u(82187),$=u.n(Ht),pe=function(e){var n=e.editor,a=e.contentClassName,t=e.contentStyle,r=e.children,s=$()("tide-content",a);return n&&n.isEmpty&&n.isReadOnly?(0,o.jsx)("div",{className:s,style:t,children:n.readOnlyEmptyView||null}):(0,o.jsx)(U.kg,{className:s,style:t,editor:n,children:r})};pe.displayName="EditorContent";var me=(0,A.createContext)(null),ge=function(){var e=(0,A.useContext)(me);if(e===null)throw new Error("useEditorContext must be used within a EditorContextProvider");return e},Nt=function(e){var n=e.editor,a=e.children,t=(0,A.useState)(!!(n!=null&&n.isEditable)),r=I()(t,2),s=r[0],i=r[1],h=(0,A.useState)(!!(n!=null&&n.fullscreen)),l=I()(h,2),c=l[0],f=l[1],p=A.useMemo(function(){return{editable:s,fullscreen:c,setEditable:i,setFullscreen:f,editor:n}},[s,c,n]);return(0,A.useEffect)(function(){if(n){i(!!(n!=null&&n.isEditable)),f(!!(n!=null&&n.fullscreen));var C=function(y){i(y.editor.isEditable),f(y.editor.fullscreen)};return n==null||n.on("update",C),function(){n==null||n.off("update",C)}}},[n]),(0,o.jsx)(me.Provider,{value:p,children:a})},Rt=function(e){var n=e.style,a=e.className,t=e.children,r=ge(),s=r.fullscreen,i=$()("tide-editor",{"tide-editor--fullscreen":s},a);return(0,o.jsx)("div",{className:i,style:n,children:t})},Bt=function(e){var n=e.editor,a=e.className,t=e.style,r=e.children;return(0,o.jsx)(Nt,{editor:n,children:(0,o.jsx)(Rt,{style:t,className:a,children:r})})},xe=(0,A.forwardRef)(function(d,e){var n=d.disabled,a=d.style,t=d.isActive,r=d.children,s=d.onClick;return(0,o.jsx)("button",{style:a,ref:e,onClick:s,disabled:n,className:$()("tide-menu-bar__btn",{"tide-menu-bar__btn--active":t,"tide-menu-bar__btn--disabled":n}),children:r})});xe.displayName="TextButton";var ye=xe,It=function(e){var n=e.className,a=e.style,t=e.title,r=(0,v.W6)(function(){return{isActive:function(){return(0,P.zh)(s.state,"ATail")},disabled:function(){return!s.state.schema.nodes.ATail||!s.can().toggleATail()}}}),s=r.editor,i=r.statusMap;return(0,o.jsx)(v.o1,{className:n,style:a,children:(0,o.jsx)(v.u,{text:"\u843D\u6B3E",children:(0,o.jsx)(ye,{onClick:function(){return s.chain().focus().toggleATail().run()},isActive:i==null?void 0:i.isActive,disabled:i==null?void 0:i.disabled,style:{width:48,justifyContent:"center",display:"flex",alignItems:"center"},children:"\u843D\u6B3E"})})})},Pt=u(45475),q=["ATitle1","ATitle2","ATitle3",1,2,3],ke={ATitle1:"\u5927\u6807\u9898",ATitle2:"\u5C0F\u6807\u9898(\u7AE0)",ATitle3:"\u5B50\u6807\u9898(\u8282)"},Ot=function(){var e=(0,A.useState)(!1),n=I()(e,2),a=n[0],t=n[1],r=(0,v.W6)(function(){var l={paragraphIsActive:function(){return(0,P.zh)(s.state,"paragraph")},paragraphIsDisabled:function(){return!s.can().setParagraph()}};return q.forEach(function(c){if(typeof c=="number")l["heading".concat(c,"IsActive")]=function(){return(0,P.zh)(s.state,"heading",{level:c})},l["heading".concat(c,"Disabled")]=function(){var p,C;return!s.state.schema.nodes.heading||!((p=(C=s.can()).toggleHeading)!==null&&p!==void 0&&p.call(C,{level:c}))};else{var f=c.split("").pop();l["".concat(c,"IsActive")]=function(){return(0,P.zh)(s.state,"ATitle",{level:Number(f)})},l["".concat(c,"Disabled")]=function(){var p,C;return!s.state.schema.nodes.heading||!((p=(C=s.can()).toggleATitle)!==null&&p!==void 0&&p.call(C,{level:Number(f)}))}}}),l}),s=r.editor,i=r.statusMap,h=function(){if(i!=null&&i.paragraphIsActive)return"\u6B63\u6587";var c=q.find(function(f){return typeof f=="number"?i==null?void 0:i["heading".concat(f,"IsActive")]:i==null?void 0:i["".concat(f,"IsActive")]});return typeof c=="number"?"\u6807\u9898 ".concat(c):ke[c]||"\u6B63\u6587"};return(0,o.jsx)(v.o1,{children:(0,o.jsx)(Pt.ZP,{placement:"bottom-start",interactive:!0,onClickOutside:function(){return t(!1)},visible:a,content:(0,o.jsx)("div",{className:"tide-dropdown-menu",children:(0,o.jsxs)("div",{className:"tide-dropdown-menu__content",children:[(0,o.jsx)("div",{onClick:function(){if(i!=null&&i.paragraphIsDisabled||!s.can().chain().focus().setParagraph().run())return!1;s.chain().focus().setParagraph().run(),t(!1)},className:$()("tide-dropdown-menu__item",{"tide-dropdown-menu__item--active":i==null?void 0:i.paragraphIsActive,"tide-dropdown-menu__item--disabled":i==null?void 0:i.paragraphIsDisabled}),children:(0,o.jsxs)("div",{className:$()("tide-menu-head-row"),children:[(0,o.jsx)("span",{children:"\u6B63\u6587"}),(0,o.jsx)("span",{className:"tide-menu-head-row__span",children:"".concat(v.WD," + ").concat(v.Kw," + 0")})]})}),q.map(function(l){return(0,o.jsx)("li",{onClick:function(){if(typeof l=="number"){if(i!=null&&i["heading".concat(l,"Disabled")]||!s.can().chain().focus().toggleHeading({level:l}).run())return!1}else{var f=l.split("").pop();if(i!=null&&i["".concat(l,"Disabled")]||!s.can().chain().focus().toggleATitle({level:Number(f)}).run())return!1}if(typeof l=="number")s.chain().focus().toggleHeading({level:l}).run();else{var p=l.split("").pop();s.chain().focus().toggleATitle({level:Number(p)}).run()}t(!1)},className:$()("tide-dropdown-menu__item",{"tide-dropdown-menu__item--active":i==null?void 0:i["heading".concat(l,"IsActive")],"tide-dropdown-menu__item--disabled":i==null?void 0:i["heading".concat(l,"Disabled")]}),children:(0,o.jsxs)("div",{className:$()("tide-menu-head-row"),children:[(0,o.jsx)("span",{className:"tide-menu-head-row__title--level".concat(l),children:ke[l]||"".concat(l,"\u7EA7\u6807\u9898")}),typeof l=="number"&&(0,o.jsx)("span",{className:"tide-menu-head-row__span",children:"".concat(v.WD," + ").concat(v.Kw," + ").concat(l)})]})},l)})]})}),children:(0,o.jsxs)("div",{className:"tide-dropdown-trigger",onClick:function(){return t(!a)},children:[(0,o.jsx)("span",{className:"tide-dropdown-trigger__head-text",children:h()}),(0,o.jsx)(ve.KCe,{className:"tide-dropdown-trigger__head-icon"})]})})})},Ft=function(e){var n=e.className,a=e.style,t=(0,v.W6)(function(){return{isActive:function(){return(0,P.zh)(r.state,"AWenHao")},disabled:function(){return!r.state.schema.nodes.AWenHao||!r.can().toggleWenHao()}}}),r=t.editor,s=t.statusMap;return(0,o.jsx)(v.o1,{className:n,children:(0,o.jsx)(v.u,{text:"\u6587\u53F7",children:(0,o.jsx)(ye,{onClick:function(){return r.chain().focus().toggleWenHao().run()},isActive:s==null?void 0:s.isActive,disabled:s==null?void 0:s.disabled,style:{width:48,justifyContent:"center",display:"flex",alignItems:"center"},children:"\u6587\u53F7"})})})},$t=function(e){var n=e.editor,a=e.disabledMenu,t=a===void 0?!1:a,r=e.menuClassName,s=e.menuStyle,i=ge(),h=i.fullscreen,l=i.editable,c=(0,A.useMemo)(function(){if(!n)return null;var f=n.state.schema.nodes,p=f.AWenHao,C=f.ATail,j=f.ALink,y=f.ATitle,T=f.bulletList,g=f.orderedList,k=f.taskList,b=f.image,L=f.table,N=f.codeBlock,R=f.blockquote,B=f.horizontalRule,M=f.emoji,S=n.state.schema.marks,m=S.bold,x=S.italic,O=S.strike,F=S.link,ee=S.code;return[[n.menuEnableUndoRedo&&(0,o.jsx)(v.WP,{},"undo"),n.menuEnableUndoRedo&&(0,o.jsx)(v.Jw,{},"redo")],[y&&(0,o.jsx)(Ot,{},"ATitle"),C&&(0,o.jsx)(It,{},"ATail"),p&&(0,o.jsx)(Ft,{},"AWenhao"),m&&(0,o.jsx)(v.d8,{},"bold"),x&&(0,o.jsx)(v.Tx,{},"italic"),O&&(0,o.jsx)(v.Re,{},"strike"),ee&&(0,o.jsx)(v.EK,{},"code")],[T&&(0,o.jsx)(v.DY,{},"bulletList"),g&&(0,o.jsx)(v.GS,{},"orderedList"),k&&(0,o.jsx)(v.ax,{},"taskList")],[F&&(0,o.jsx)(ut,{},"link"),b&&(0,o.jsx)(v.Ee,{},"image"),L&&(0,o.jsx)(v.iA,{},"table"),N&&(0,o.jsx)(v.dn,{},"codeBlock")],[R&&(0,o.jsx)(v.V6,{},"blockquote"),B&&(0,o.jsx)(v.bo,{},"horizontalRule"),M&&(0,o.jsx)(v.dy,{},"emoji")],[n.menuEnableFullscreen&&(0,o.jsx)(v.iT,{fullscreen:h,onFullscreenChange:function(Y){n.setFullscreen(Y)}},"fullscreen")]].map(function(w){return w.filter(Boolean)}).filter(function(w){return w.length>0}).map(function(w,Y,Xt){return(0,o.jsxs)(A.Fragment,{children:[w,Y<Xt.length-1&&(0,o.jsx)(v.uy,{})]},Y)})},[n,l,h,n==null?void 0:n.menuEnableUndoRedo,n==null?void 0:n.menuEnableFullscreen]);return!l&&!(n!=null&&n.readOnlyShowMenu)?null:(0,o.jsx)(v.j_,{className:$()(r,{disabled:(n==null?void 0:n.readOnlyShowMenu)||t}),style:s,children:c})},Ce=function(e){var n=e.editor,a=e.className,t=e.style,r=e.menuClassName,s=e.menuStyle,i=e.contentClassName,h=e.contentStyle;return n?(0,o.jsx)(Bt,{editor:n,style:t,className:a,children:(0,o.jsxs)(v.lv,{editor:n,children:[(0,o.jsx)($t,{editor:n,menuStyle:s,menuClassName:r}),(0,o.jsxs)(pe,{editor:n,contentStyle:h,contentClassName:i,children:[(0,o.jsx)(oe.dC,{editor:n}),(0,o.jsx)(G.d6,{editor:n}),(0,o.jsx)(le.El,{editor:n}),(0,o.jsx)(v.OA,{editor:n})]})]})}):null};Ce.displayName="EditorRender";var wt=function(e,n){return(0,U.jE)(Et,e,n)},Dt=["starterKitOpt","parseOptions","editorProps","mode","onChange","debug","height","value","onReady"],Wt=function(){var d=Me()(ae()().mark(function e(n,a){var t,r;return ae()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t="",r=new FileReader,r.onload=function(){t=r.result},r.readAsDataURL(n),console.log("file",n),i.abrupt("return",new Promise(function(h){var l=1,c=setInterval(function(){l++,a(l*10),l>=10&&(clearInterval(c),h(t))},300)}));case 6:case"end":return i.stop()}},e)}));return function(n,a){return d.apply(this,arguments)}}(),zt=function(e){var n=e.starterKitOpt,a=e.parseOptions,t=e.editorProps,r=e.mode,s=r===void 0?"json":r,i=e.onChange,h=e.debug,l=e.height,c=l===void 0?500:l,f=e.value,p=e.onReady,C=ne()(e,Dt),j=A.useState(!1),y=I()(j,2),T=y[0],g=y[1],k=A.useState(),b=I()(k,2),L=b[0],N=b[1],R=wt({extensions:[Se,He,Ee,pt,dt.configure(E()({link:!1,uploader:{image:{uploader:Wt}}},n))],onChange:function(M,S){var m;s==="json"?m=M:s==="md"?m=S.getMarkdown():m=S.getHTML(),N(m),i==null||i(m,S)},editorProps:t,parseOptions:a||{},onReady:function(M){h&&console.log("editor onReady",M),p==null||p(M),g(!0)}});return(0,A.useEffect)(function(){T&&L!==f&&(h&&console.log("editor setContent",f),N(f),R==null||R.setContent(f||""))},[f,T]),(0,o.jsx)("div",{className:"main",children:(0,o.jsx)(Ce,E()({editor:R,style:{height:c}},C))})},Vt=zt;function Ut(d){if(!d)return{};var e={};if(d.indexOf("?")!==-1)for(var n=d.split("?")[1],a=n.split("&"),t=0;t<a.length;t++)e[a[t].split("=")[0]]=decodeURI(a[t].split("=")[1]);return e}function K(d){var e,n=d.marks,a=d.text,t=d.onLinkClick,r=d.linkRender;if(!n||n.length===0)return _jsx("span",{children:a});var s=n[0],i=n.slice(1),h={};if(s.type==="link"){var l;h=Ut((l=s.attrs)===null||l===void 0?void 0:l.href)}var c=s.type==="link"?_jsx("a",{title:"\u67E5\u770B\u5F15\u7528","data-href":(e=s.attrs)===null||e===void 0?void 0:e.href,onClick:function(){t==null||t(h)},target:s.attrs.target,children:K({marks:i,text:a,onLinkClick:t})},s.key):null;switch(s.type){case"link":return r?r(c,s,h):c;case"bold":return _jsx("strong",{children:K({marks:i,text:a,onLinkClick:t,linkRender:r})},s.key);case"italic":return _jsx("em",{children:K({marks:i,text:a,onLinkClick:t,linkRender:r})},s.key);default:return _jsx("span",{children:K({marks:i,text:a,onLinkClick:t,linkRender:r})},s.key)}}function Kt(d,e,n){return _jsx("span",{style:e,children:K({marks:d.marks,text:d.text,onLinkClick:n.onLinkClick,linkRender:n.linkRender})},d.key)}var en=null,X=!1,tn=function(e,n){if(!e.content)return _jsx(_Fragment,{});var a=function(r){return r==null?void 0:r.map(function(s){if(s.type==="text"){var i=X?{paddingLeft:"2em"}:{};return X=!1,s.marks?Kt(s,i,n):_jsx("span",{style:i,children:s.text},s.key)}return s.type==="hardBreak"?(X=!0,_jsx("br",{},s.key)):_jsx("span",{children:s.text},s.key)})};return _jsx("div",{className:"tide-content",children:_jsx("div",{className:"tiptap ProseMirror",children:e.content.map(function(t){if(t.type==="hardBreak")return X=!0,_jsx("br",{},t.key);if(t.type==="ATitle")return _jsx("div",{id:t.key,className:"a-tiptap-title".concat(t.attrs.level),children:a(t.content)},t.key);if(t.type==="ATail")return _jsx("div",{className:"a-tiptap-tail",children:a(t.content)},t.key);if(t.type==="AWenHao")return _jsx("div",{className:"a-tiptap-wenhao",children:a(t.content)},t.key);if(t.type==="paragraph"&&!t.content)return _jsx("p",{children:_jsx("br",{className:"ProseMirror-trailingBreak"})},t.key);if(t.type==="horizontalRule")return _jsx("hr",{contentEditable:"false"},t.key);if(t.type==="codeBlock")return _jsx("div",{className:"react-renderer node-codeBlock",children:_jsx("div",{className:"tide-code-block",style:{whiteSpace:"normal"},children:_jsx("div",{className:"tide-code-block__content",children:_jsx("pre",{className:"hljs",children:_jsx("code",{style:{whiteSpace:"pre-wrap"},children:_jsx("div",{style:{whiteSpace:"inherit"},children:"\u6682\u4E0D\u652F\u6301"})})})})})},t.key);if(t.type==="heading")switch(t.attrs.level){case 1:return _jsx("h1",{id:t.key,style:{textAlign:t.attrs.textAlign},children:a(t.content)},t.key);case 2:return _jsx("h2",{id:t.key,style:{textAlign:t.attrs.textAlign},children:a(t.content)},t.key);case 3:return _jsx("h3",{id:t.key,style:{textAlign:t.attrs.textAlign},children:a(t.content)},t.key);case 4:return _jsx("h4",{id:t.key,style:{textAlign:t.attrs.textAlign},children:a(t.content)},t.key);case 5:return _jsx("h5",{id:t.key,style:{textAlign:t.attrs.textAlign},children:a(t.content)},t.key);case 6:return _jsx("h6",{id:t.key,style:{textAlign:t.attrs.textAlign},children:a(t.content)},t.key);default:return _jsx("h1",{id:t.key,style:{textAlign:t.attrs.textAlign},children:a(t.content)},t.key)}return _jsx("p",{children:a(t.content)},t.key)})})})},nn=function(e){if(!e)return[];for(var n=1,a=e.content,t=[],r=0;r<a.length;r++){var s=n++,i=a[r];if(i.type==="ATitle"||i.type==="heading"){var h={title:i.content[0].text,label:i.content[0].text,key:"".concat(s),value:"".concat(s),isLeaf:!0,children:[],pcode:"-1"};if(i.attrs.level===1)t.push(h);else if(i.attrs.level===2&&t.length>0){var l=t[t.length-1];h.pcode=l.value,h.isLeaf=!1,l.children.push(h)}}}return t},Jt=Vt,J={margin:"0 10px",padding:"5px 10px",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},Gt=function(){var d=(0,A.useState)(),e=I()(d,2),n=e[0],a=e[1],t=(0,A.useState)("html"),r=I()(t,2),s=r[0],i=r[1],h=(0,A.useState)(),l=I()(h,2),c=l[0],f=l[1],p=(0,A.useState)(),C=I()(p,2),j=C[0],y=C[1],T=(0,A.useState)(),g=I()(T,2),k=g[0],b=g[1],L=A.useRef(),N=function(x,O){console.log("onChange",x,O),a(x),S()},R=function(x){b(x),a(x)},B=function(x){f(x),a(x)},M=function(x){if(!x.includes("{")){y("");return}try{y(x);var O=JSON.parse(x);a(O)}catch(F){console.log("\u65E0\u6548json")}},S=function(){b(L.current.getHTML()),f(L.current.getMarkdown()),y(JSON.stringify(L.current.getJSON()))};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("h2",{children:["\u8FD0\u884C\u7684\u6A21\u5F0F\uFF1A",s]}),(0,o.jsx)(Jt,{onReady:function(x){window.editor=x,L.current=x},mode:s,value:n,onChange:N}),(0,o.jsxs)("div",{style:{marginTop:12},children:[(0,o.jsx)("button",{style:J,onClick:function(){a("<p>123</p>")},children:"\u53EA\u8BFB\u6A21\u5F0F"}),(0,o.jsx)("button",{style:J,onClick:function(){i("html"),R("<p>123</p>")},children:"\u8D4B\u503Chtml"}),(0,o.jsx)("button",{style:J,onClick:function(){i("md"),B("! \u4F60\u597D")},children:"\u8D4B\u503Cmd"}),(0,o.jsx)("button",{style:J,onClick:function(){i("json"),M('{"type":"doc","content":[{"type":"paragraph","attrs":{"textAlign":"left","indent":0},"content":[{"type":"text","text":"\u963F\u8428\u8FBE\u963F\u8428\u5927\u5927\u548B\u6253\u6253\u7B97111"},{"type":"text","marks":[{"type":"link","attrs":{"href":"\u963F\u8428\u5927\u5927","target":"_blank","data-id":123131321}}],"text":"\u963F\u8428\u5927\u5927"}]}]}')},children:"\u8D4B\u503Cjson"}),(0,o.jsx)("button",{style:J,id:"parseContentToInputBox",onClick:S,children:"\u89E3\u6790\u6570\u636E\u5230\u8F93\u5165\u6846"})]}),(0,o.jsx)("h3",{children:"jsonValue"}),(0,o.jsx)("textarea",{id:"jsonValue",value:j,onChange:function(x){return M(x.target.value)},style:{width:"100%"},rows:4}),(0,o.jsx)("h3",{children:"htmlValue"}),(0,o.jsx)("textarea",{id:"htmlValue",value:k,onChange:function(x){return R(x.target.value)},style:{width:"100%"},rows:4}),(0,o.jsx)("h3",{children:"mdValue"}),(0,o.jsx)("textarea",{id:"mdValue",value:c,onChange:function(x){return B(x.target.value)},style:{width:"100%"},rows:4})]})}}}]);
